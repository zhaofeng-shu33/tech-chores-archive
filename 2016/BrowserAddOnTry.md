这两天我看了一下关于ie和firefox浏览器利用插件快速查词的资料，并在原来index.html名词词典上添加了鼠标double clixk查词的功能.

首先，利用 `<body ondblclick="GetSelection()">` 事件可以很容易地获取到当前body下选中的单词，主要时间花在多框架html子窗体将得到的单词交给左边的导航栏处理，并根据处理的结果对子窗体进行跳转。

用事件listen的方法可以在自己做的client网页上查词，但要想在从别的server那里得到的网页上查词，可能要借助浏览器插件(add-on, plugin, or web-extension)。

浏览器插件因浏览器而异，至少ie和firefox就完全不通用。

在ie方面，通过修改注册表，注册了自己的右键快捷菜单--search word,该菜单会自动触发一个本地的固定目录下的html文件，主要是执行里面的js脚本，可以取得当前页面我选中的单词，以alert的方式原样返回。

在firefox方面，可以只通过写脚本的方式做web-extension,即可以写一个全局的js文件，获取到当前页面我选中的单词，用console.debug输出。

在浏览器查词插件方面，仍有很多问题没有解决:

1. 做IE的插件要基于ActiveX,似乎必须用(VS)C++,C#等，(开源的FireBreath能跨不同的browser，但光是学会它依赖的工具集(boost, cmake)等就不容易)要手动开发难度较大，在最近的短时间内我没有尝试。

2. 插件本身应该不能做很复杂的查表运算，最开始我尝试了用插件直接加载xml单词文件的方法(xml是js可以直接操作的少数本地文件类型之一)，但考虑到插件刷新率很高，而xml要存英汉词典的规模文件会比较大，所以没有继续这个思路。(如果仅仅存key-value的话，也许可以接收，但最好还是有一个background,xml只加载一次，而不是来一个查词请求把本地的xml解析一遍，这一点用firefox的开发框架应该可以做到)后来我理解插件应该主要起到数据中转的作用，要么送给本地应用程序，要么送到server,我本想尝试将自制的ie或firefox的简易plugin获得的数据送到本地应用程序(python or Qt),但遇到了很多困难，基本上都没有解决。

(1)client 方面用javascript中转数据有很多限制。

(2)ie右键菜单的方式能在后台的html中写的脚本内容可能有一些限制，一些单独可以执行的html却不能以后台的方式运行。

(3)firefox 对native message支持不是很好，它借鉴了google chrome的runtime.port 的api,但有一些很关键的与本地应用程序通信的方法firefox却不支持。

我考虑了用串口转数据的方法，网上web client side直接发数据到串口的资料比较有限，虽然我分别找到了在ie和firefox上别人做好的类可以实现单独的html文件发数据到串口。但做成简易plugin这些类都出现陌名其妙的问题，可能有时序的原因或后台脚本不能声明html的一些元素。

最后我考虑先用后台脚本调起一个本地的exe专门用来将收到的数据发到串口，这方面在windows系统上用ie做比较方便，通过在js中使用官方提供的ActiveX(wscript.shell)可以执行一个exe程序并传参。

exe程序用Qt的命令行往串口发数据的示例改了改，最终可以用串口精灵收到ie简易插件脚本调用本地专职的exe发的单词。

3 插件如何取回数据？在firefox中，可以做一个工具小图标，每当用户click时，就会有一个很小的弹出窗口，窗口虽小,但它是由html/css/js组成的，利用这个global的小窗口，应该可以比较容易地实现与server数据交换。由于firefox插件是以脚本形式写的，下载到的add-on解压后就是source code,而activeX打包后是binary。即使如此，能学会做firefox add-on可能不是一两天的功夫。

相比之下，从本地应用程序取回数据难度比较大，我只能猜想一些单词软件拿到浏览器的单词数据后并没有返回，而是通过浮动窗口等技术使得应用程序能够（比如知道当前鼠标的位置，在这个位置以应用程序自己的窗体附近展示出单词的意思),这方面的很多技术细节我现在并不清楚，可能绝大部分开源词典并不具备这一功能(据说Babylon有浏览器插件，但主要是基于与server直接交互的)。

4 我只是实现了基于win7从browser获取数据送到串口，写一个Qt GUI程序再实时地拿到数据并不困难，应用程序本地查词也有迹可循，只是后面如何展示数据?---用户是在使用broswer 而不是你自己开发的阅读器!

